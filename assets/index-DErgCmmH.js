import{j as e,u as B,m as xe,o as Te,r as p}from"./vendor-B1gV91ol.js";import{A as Q,U as $,P as ie}from"./index-BX_kuCcN.js";import{g as qe,u as pe,S as b,a as ze,b as Re,c as Be}from"./index-CD0OFpat.js";import{c as P,u as Ve}from"./vendor-route-DDSpTbF5.js";import{n as Ge,I as he,p as Oe,D as ge,B as y,L as me,b as je,c as fe,f as ve,m as E,q as ae,r as oe,s as ce,t as m,u as c,v as le,w as Ke,x as He,o as D,g as Je,V as Xe,y as Ye,R as Ze,i as en,C as nn}from"./vendor-ui-OeklMkKU.js";import{u as ye,b as M,c as sn}from"./vendor-store-zNU_bmKY.js";import{u as tn}from"./index-C5HxE152.js";import{a as V}from"./index-t--hEgTQ.js";import{U as G}from"./common-MNloumS_.js";const U=({inputRef:t,ariaLabel:s,rows:n=2,value:r,defaultValue:o,...a})=>{const i=r!==""&&r!==void 0;return e.jsx(Ge,{inputRef:t,inputProps:{"aria-label":s,style:{fontSize:16}},fullWidth:!0,multiline:!0,rows:n,size:"small",InputProps:{endAdornment:i&&a.onClear&&e.jsx(he,{size:"small",onClick:a.onClear,children:e.jsx(Oe,{})})},defaultValue:o,value:r,onChange:a.onChange})},rn=async({token:t,id:s})=>{await V.delete(`${G}/${s}`,{headers:{"word-app-api-key":t},data:{id:s}})},an=async({token:t,appName:s,seq:n})=>{await V.delete(`${G}/${n}`,{headers:{"word-app-api-key":t},data:{seq:n,app_name:s}})},on=async({token:t,appName:s,pageIndex:n})=>(await V.get(G,{headers:{"word-app-api-key":t},params:{page:n,appName:s}})).data.userMeanings,cn=({token:t})=>{const s=B();return{updateAppList:r=>{s.setQueryData(qe(t),r)}}},ln=({onSuccess:t,onError:s})=>xe({mutationFn:rn,onSuccess:t,onError:s}),dn=({onSuccess:t,onError:s})=>xe({mutationFn:an,onSuccess:t,onError:s}),Me=(t,s)=>["UserMeanings",t,s],un=({token:t,appName:s})=>Te({queryKey:Me(t,s),enabled:s!==void 0,staleTime:1/0,gcTime:1/0,initialPageParam:1,queryFn:async({pageParam:n})=>on({token:t,appName:s,pageIndex:n}),getNextPageParam:n=>n.next_page??void 0,select:n=>n.pages.map(r=>r.data).flat()}),O=({token:t,appName:s})=>{const n=B(),r=Me(t,s),o=n.getQueryData(r);return{removeUserMeaningFromList:({id:i,seq:l})=>{if(i===void 0&&l===void 0||o===void 0)return 0;const d=o.pages[0].data,x=d.filter(g=>g.id!==i&&g.seq!==l),u=d.length-x.length;return n.setQueryData(r,{pageParams:o.pageParams,pages:[{...o.pages[0],data:x},...o.pages.slice(1)]}),u}}},de=200,xn=()=>{const{appName:t}=P(),{showAlertSnackbar:s}=p.useContext(Q),{data:n}=pe({onError:()=>{s({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),r=ye(b),o=Ve();p.useEffect(()=>{var l;((l=n==null?void 0:n.find(({name:d})=>d===t))==null?void 0:l.count)===0&&(o("/user_meanings",{replace:!0}),r(void 0))});const a=i=>{r(void 0),o(`/user_meanings/${i}`)};return e.jsx(ge,{variant:"permanent",sx:{width:de,flexShrink:0,"& .MuiDrawer-paper":{width:de,boxSizing:"border-box",position:"absolute"}},children:e.jsx(y,{sx:{overflow:"auto"},children:e.jsx(me,{children:n==null?void 0:n.map(({name:i,count:l,version:d})=>e.jsx(je,{disablePadding:!0,children:e.jsx(fe,{disabled:l===0,selected:i===t,onClick:()=>a(i),children:e.jsx(ve,{primary:i,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(E,{component:"span",display:"block",children:["- version: ",d]}),e.jsxs(E,{component:"span",display:"block",children:["- count: ",l]})]})})})},i))})})})},L=t=>{const s=t??"",[n,r]=p.useState(s);return p.useEffect(()=>{r(s)},[s]),[n,i=>{r(i.target.value)},()=>r("")]},K=({onError:t})=>{const{appName:s}=P(),{token:n}=M($),{isLoading:r,isError:o,error:a,data:i,hasNextPage:l,isFetchingNextPage:d,fetchNextPage:x}=un({token:n,appName:s});return p.useEffect(()=>{o&&t(a)},[o]),{isLoadingUserMeanings:r,userMeanings:i,hasNextPage:l,isFetchingNextPage:d,fetchNextPage:x}},H=()=>{const{userMeanings:t}=K({onError:()=>{}}),s=ye(b),n=t??[];return{selectNextUserMeaning:({id:o})=>{if(o===void 0)return;const a=n.findIndex(i=>i.id===o)+1;a<n.length?s(n[a]):s(void 0)}}},pn=({onSuccess:t,onError:s})=>{const{appName:n}=P(),{id:r,seq:o}=M(b)??{},{token:a}=M($),{selectNextUserMeaning:i}=H(),{removeUserMeaningFromList:l}=O({token:a,appName:n}),{updateAppList:d}=cn({token:a}),{mutate:x}=dn({onSuccess:t,onError:s});return{deleteSelectedUserMeaning:()=>{if(o===void 0||n===void 0)return;x({token:a,seq:o,appName:n}),i({id:r});const g=l({seq:o});d(j=>j.map(h=>{const{name:C,count:f}=h;if(C===n){const v=f-g;return{...h,count:v<0?0:v}}return h}))}}},hn=({onSuccess:t,onError:s})=>{const{appName:n}=P(),{selectNextUserMeaning:r}=H(),o=M(b),{id:a}=o??{},{token:i}=M($),{removeUserMeaningFromList:l}=O({token:i,appName:n}),{mutate:d}=ln({onSuccess:t,onError:s});return{skipSelectedUserMeaning:()=>{a!==void 0&&(d({token:i,id:a.toString()}),r({id:a}),l({id:a}))}}},gn=()=>{const t=B(),s=p.createRef(),{token:n}=M($),{showAlertSnackbar:r}=p.useContext(Q),o=M(b),{app_name:a,id:i,seq:l,os:d,by_part:x,by_unit:u,by_index:g,word:j,modified_word:h,original_pronunciation:C,modified_pronunciation:f,original_meaning:v,modified_meaning:w,original_example:A,modified_example:S,original_example_meaning:_,modified_example_meaning:I,device_unique_id:J}=o??{},{selectNextUserMeaning:Ce}=H(),{removeUserMeaningFromList:Ue}=O({token:n,appName:a}),[W,be,X]=L(h),[T,we,Y]=L(f),[q,Se,Z]=L(w),[z,Ie,ee]=L(S),[R,ke,ne]=L(I),N=()=>{X(),Y(),Z(),ee(),ne()},se=()=>{N(),t.invalidateQueries(),Ce({id:i}),Ue({seq:l}),r({severity:"success",message:"삭제하였습니다."})},k=()=>r({severity:"error",message:"삭제에 실패하였습니다. 다시 시도해주세요."}),{mutate:Le}=tn({onSuccess:se,onError:k}),te=()=>{if(a===void 0||l===void 0){k();return}Le({token:n,appName:a,seq:Number(l),word:(h??"").trim()!==""?h:void 0,pronunciation:(f??"").trim()!==""?f:void 0,meaning:(w??"").trim()!==""?w:void 0,example:(S??"").trim()!==""?S:void 0,exampleMeaning:(I??"").trim()!==""?I:void 0})},{mutate:Ee}=ze({onSuccess:te,onError:k}),{deleteSelectedUserMeaning:Pe}=pn({onSuccess:se,onError:k}),{skipSelectedUserMeaning:Ae}=hn({onSuccess:()=>{t.invalidateQueries(),r({severity:"success",message:"스킵하였습니다."})},onError:()=>{r({severity:"error",message:"스킵에 실패하였습니다. 다시 시도해주세요."})}}),{addWrongPronunciation:_e}=Re({onSuccess:te,onError:k});if(o===void 0)return;const Ne=F=>{navigator.clipboard.writeText(F).then(()=>{t.invalidateQueries(),r({severity:"success",message:"복사하였습니다."})},()=>{r({severity:"error",message:"복사에 실패하였습니다. 다시 시도해주세요."})})},Fe=()=>Ne(`${l}`),De=()=>{var re;const F=((re=s.current)==null?void 0:re.value)??"";i===void 0||F===""||l===void 0||a===void 0||Ee({token:n,seq:l,appName:a,userQuery:F,word:j,modifiedWord:h,originalMeaning:v,modifiedMeaning:w,originalPronunciation:C,modifiedPronunciation:f,originalExample:A,modifiedExample:S,originalExampleMeaning:_,modifiedExampleMeaning:I,deviceUniqueId:J,os:d})},Qe=()=>{l===void 0||a===void 0||["",void 0].includes(j)||(_e({seq:l,appName:a,word:j,modifiedWord:h,originalMeaning:v,modifiedMeaning:w,originalPronunciation:C,modifiedPronunciation:f,originalExample:A,modifiedExample:S,originalExampleMeaning:_,modifiedExampleMeaning:I,deviceUniqueId:J,os:d}),N())},$e=()=>{Pe(),N()},We=()=>{Ae(),N()};return e.jsxs(y,{sx:{overflow:"auto",p:3,height:"100vh"},children:[e.jsx(E,{component:"h2",variant:"h5",children:"기본 정보"}),e.jsx(ae,{sx:{mb:3},children:e.jsxs(oe,{sx:{minWidth:650},"aria-label":"단어 기본 정보",size:"small",children:[e.jsx(ce,{children:e.jsxs(m,{children:[e.jsx(c,{children:"OS"}),e.jsx(c,{children:"Seq"}),e.jsx(c,{children:"Part"}),e.jsx(c,{children:"Unit"}),e.jsx(c,{children:"Index"})]})}),e.jsx(le,{children:e.jsxs(m,{children:[e.jsx(c,{children:d}),e.jsxs(c,{children:[l,e.jsx(he,{"aria-label":"copy",size:"small",onClick:Fe,children:e.jsx(Ke,{fontSize:"small"})})]}),e.jsx(c,{children:x}),e.jsx(c,{children:u}),e.jsx(c,{children:g})]})})]})}),e.jsx(E,{component:"h2",variant:"h5",children:"수정 정보"}),e.jsx(ae,{sx:{mb:3},children:e.jsxs(oe,{sx:{minWidth:650},"aria-label":"단어 수정 정보",size:"small",children:[e.jsx(ce,{children:e.jsxs(m,{children:[e.jsx(c,{width:"10%",children:"구분"}),e.jsx(c,{width:"30%",children:"원본"}),e.jsx(c,{width:"60%",children:"수정"})]})}),e.jsxs(le,{children:[e.jsxs(m,{children:[e.jsx(c,{component:"th",scope:"row",children:"단어"}),e.jsx(c,{sx:{fontSize:16},children:j}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"word input",value:W,onClear:X,onChange:be},`${i}-word`)})]}),e.jsxs(m,{children:[e.jsx(c,{component:"th",scope:"row",children:"발음"}),e.jsx(c,{sx:{fontSize:16},children:C}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"pronunciation input",value:T,onClear:Y,onChange:we},`${i}-pronunciation`)})]}),e.jsxs(m,{children:[e.jsx(c,{component:"th",scope:"row",children:"뜻"}),e.jsx(c,{sx:{fontSize:16},children:v}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"meaning input",value:q,onClear:Z,onChange:Se},`${i}-meaning`)})]}),e.jsxs(m,{children:[e.jsx(c,{component:"th",scope:"row",children:"예제"}),e.jsx(c,{sx:{fontSize:16},children:A}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"example input",value:z,onClear:ee,onChange:Ie},`${i}-example`)})]}),e.jsxs(m,{children:[e.jsx(c,{component:"th",scope:"row",children:"예제 뜻"}),e.jsx(c,{sx:{fontSize:16},children:_}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"example meaning input",value:R,onClear:ne,onChange:ke},`${i}-example-meaning`)})]})]})]})}),e.jsx(E,{component:"h2",variant:"h5",children:"SQL query"}),e.jsx(U,{inputRef:s,ariaLabel:"SQL query input",rows:5,defaultValue:Be({seq:l,word:j,editedWord:W,editedPronunciation:T,originalPronunciation:C,editedMeaning:q,originalMeaning:v,editedExample:z,originalExample:A,editedExampleMeaning:R,originalExampleMeaning:_})},`${W}-${T}-${q}-${z}-${R}`),e.jsx(y,{justifyContent:"center",sx:{width:1,display:"flex",mt:2},children:e.jsxs(He,{spacing:6,direction:"row",children:[e.jsx(D,{variant:"contained",sx:{px:8},startIcon:e.jsx(Je,{}),onClick:De,children:"수정"}),e.jsx(D,{variant:"contained",sx:{px:8},startIcon:e.jsx(Xe,{}),onClick:Qe,children:"발음 이상"}),e.jsx(D,{variant:"contained",color:"error",sx:{px:8},startIcon:e.jsx(Ye,{}),onClick:$e,children:"삭제"}),e.jsx(D,{variant:"contained",color:"success",sx:{px:8},startIcon:e.jsx(Ze,{}),onClick:We,children:"스킵"})]})})]})},ue=200,mn=()=>{const{appName:t}=P(),{showAlertSnackbar:s}=p.useContext(Q),[n,r]=sn(b),o=p.useRef(null),{userMeanings:a,hasNextPage:i,isFetchingNextPage:l,fetchNextPage:d}=K({onError:()=>{s({severity:"error",message:"단어 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),x=u=>r(u);if(p.useEffect(()=>{if(!o.current)return;const u=new IntersectionObserver(g=>{g[0].isIntersecting&&i&&d()});return u.observe(o.current),()=>u.disconnect()},[o,i,d]),!(t===void 0||a===void 0||a.length===0))return e.jsx(ge,{variant:"permanent",sx:{width:ue,flexShrink:0,"& .MuiDrawer-paper":{width:ue,boxSizing:"border-box",position:"absolute"}},children:e.jsx(y,{sx:{overflow:"auto"},children:e.jsxs(me,{children:[a.map(u=>e.jsx(je,{disablePadding:!0,children:e.jsx(fe,{selected:u===n,onClick:()=>x(u),children:e.jsx(ve,{primary:e.jsxs(e.Fragment,{children:[u.by_part,"/",u.by_unit,"/",u.by_index,e.jsx("br",{}),u.word]})})})},u.id)),e.jsx("div",{ref:o,style:{height:40},children:l&&e.jsx(en,{})})]})})})},Sn=()=>{const{showAlertSnackbar:t}=p.useContext(Q),{isLoadingApps:s}=pe({onError:()=>{t({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),{isLoadingUserMeanings:n}=K({onError:()=>{t({severity:"error",message:"단어 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}});return e.jsx(nn,{component:"main",maxWidth:!1,sx:{position:"relative"},disableGutters:!0,children:e.jsx(y,{display:"flex",height:"100vh",children:s?e.jsx(ie,{}):e.jsxs(e.Fragment,{children:[e.jsx(xn,{}),n?e.jsx(ie,{}):e.jsxs(y,{sx:{display:"flex",flexGrow:1,position:"relative"},children:[e.jsx(mn,{}),e.jsx(y,{sx:{flexGrow:1,position:"relative"},children:e.jsx(gn,{})})]})]})})})};export{Sn as default};
