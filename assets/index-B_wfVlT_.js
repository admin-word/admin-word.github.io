import{j as e,u as R,m as xe,o as Ve,r as p}from"./vendor-B1gV91ol.js";import{A as z,U as T,P as te}from"./index-h4SDZcon.js";import{g as Ge,u as pe,S as k,a as Oe,b as Ke,c as He}from"./index-CjrOE57i.js";import{c as A,u as Je}from"./vendor-route-DDSpTbF5.js";import{n as Xe,I as he,p as Ye,D as me,B as w,L as ge,b as je,c as fe,f as ve,m as _,q as ae,r as oe,s as ce,t as h,u as c,v as de,w as Ze,x as en,o as Q,g as nn,V as sn,y as rn,R as tn,i as an,C as on}from"./vendor-ui-OeklMkKU.js";import{u as Ce,b,c as cn}from"./vendor-store-zNU_bmKY.js";import{u as dn}from"./index-zsJ_DbT9.js";import{a as B}from"./index-t--hEgTQ.js";import{U as V}from"./common-MNloumS_.js";const U=({inputRef:i,ariaLabel:s,rows:n=2,value:t,defaultValue:o,...a})=>{const r=t!==""&&t!==void 0;return e.jsx(Xe,{inputRef:i,inputProps:{"aria-label":s,style:{fontSize:16}},fullWidth:!0,multiline:!0,rows:n,size:"small",InputProps:{endAdornment:r&&a.onClear&&e.jsx(he,{size:"small",onClick:a.onClear,children:e.jsx(Ye,{})})},defaultValue:o,value:t,onChange:a.onChange})},ln=async({token:i,id:s})=>{await B.delete(`${V}/${s}`,{headers:{"word-app-api-key":i},data:{id:s}})},un=async({token:i,appName:s,seq:n})=>{await B.delete(`${V}/${n}`,{headers:{"word-app-api-key":i},data:{seq:n,app_name:s}})},xn=async({token:i,appName:s,pageIndex:n})=>(await B.get(V,{headers:{"word-app-api-key":i},params:{page:n,appName:s}})).data.userMeanings,pn=({token:i})=>{const s=R();return{updateAppList:t=>{s.setQueryData(Ge(i),t)}}},hn=({onSuccess:i,onError:s})=>xe({mutationFn:ln,onSuccess:i,onError:s}),mn=({onSuccess:i,onError:s})=>xe({mutationFn:un,onSuccess:i,onError:s}),ye=(i,s)=>["UserMeanings",i,s],gn=({token:i,appName:s})=>Ve({queryKey:ye(i,s),enabled:s!==void 0,staleTime:1/0,gcTime:1/0,initialPageParam:1,queryFn:async({pageParam:n})=>xn({token:i,appName:s,pageIndex:n}),getNextPageParam:n=>n.next_page??void 0,select:n=>n.pages.map(t=>t.data).flat()}),G=({token:i,appName:s})=>{const n=R(),t=ye(i,s),o=n.getQueryData(t);return{removeUserMeaningFromList:({id:r,seq:d})=>{if(r===void 0&&d===void 0||o===void 0)return 0;const l=o.pages[0].data,x=l.filter(m=>m.id!==r&&m.seq!==d),u=l.length-x.length;return n.setQueryData(t,{pageParams:o.pageParams,pages:[{...o.pages[0],data:x},...o.pages.slice(1)]}),u}}},le=200,jn=()=>{const{appName:i}=A(),{showAlertSnackbar:s}=p.useContext(z),{data:n}=pe({onError:()=>{s({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),t=Ce(k),o=Je();p.useEffect(()=>{var d;((d=n==null?void 0:n.find(({name:l})=>l===i))==null?void 0:d.count)===0&&(o("/user_meanings",{replace:!0}),t(void 0))});const a=r=>{t(void 0),o(`/user_meanings/${r}`)};return e.jsx(me,{variant:"permanent",sx:{width:le,flexShrink:0,"& .MuiDrawer-paper":{width:le,boxSizing:"border-box",position:"absolute"}},children:e.jsx(w,{sx:{overflow:"auto"},children:e.jsx(ge,{children:n==null?void 0:n.map(({name:r,count:d,version:l})=>e.jsx(je,{disablePadding:!0,children:e.jsx(fe,{disabled:d===0,selected:r===i,onClick:()=>a(r),children:e.jsx(ve,{primary:r,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(_,{component:"span",display:"block",children:["- version: ",l]}),e.jsxs(_,{component:"span",display:"block",children:["- count: ",d]})]})})})},r))})})})},L=i=>{const s=i??"",[n,t]=p.useState(s);return p.useEffect(()=>{t(s)},[s]),[n,r=>{t(r.target.value)},()=>t("")]},O=({onError:i})=>{const{appName:s}=A(),{token:n}=b(T),{isLoading:t,isError:o,error:a,data:r,hasNextPage:d,isFetchingNextPage:l,fetchNextPage:x}=gn({token:n,appName:s});return p.useEffect(()=>{o&&i(a)},[o]),{isLoadingUserMeanings:t,userMeanings:r,hasNextPage:d,isFetchingNextPage:l,fetchNextPage:x}},K=()=>{const{userMeanings:i}=O({onError:()=>{}}),s=Ce(k),n=i??[];return{selectNextUserMeaning:({id:o})=>{if(o===void 0)return;const a=n.findIndex(r=>r.id===o)+1;a<n.length?s(n[a]):s(void 0)}}},fn=({onSuccess:i,onError:s})=>{const{appName:n}=A(),{id:t,seq:o}=b(k)??{},{token:a}=b(T),{selectNextUserMeaning:r}=K(),{removeUserMeaningFromList:d}=G({token:a,appName:n}),{updateAppList:l}=pn({token:a}),{mutate:x}=mn({onSuccess:i,onError:s});return{deleteSelectedUserMeaning:()=>{if(o===void 0||n===void 0)return;x({token:a,seq:o,appName:n}),r({id:t});const m=d({seq:o});l(g=>g.map(S=>{const{name:E,count:q}=S;if(E===n){const j=q-m;return{...S,count:j<0?0:j}}return S}))}}},vn=({onSuccess:i,onError:s})=>{const{appName:n}=A(),{selectNextUserMeaning:t}=K(),o=b(k),{id:a}=o??{},{token:r}=b(T),{removeUserMeaningFromList:d}=G({token:r,appName:n}),{mutate:l}=hn({onSuccess:i,onError:s});return{skipSelectedUserMeaning:()=>{a!==void 0&&(l({token:r,id:a.toString()}),t({id:a}),d({id:a}))}}},Cn=()=>{const i=R(),s=p.createRef(),{token:n}=b(T),{showAlertSnackbar:t}=p.useContext(z),o=b(k),{app_name:a,id:r,seq:d,os:l,by_part:x,by_unit:u,by_index:m,word:g,modified_word:S,original_pronunciation:E,modified_pronunciation:q,original_meaning:j,modified_meaning:Me,original_example:N,modified_example:Ue,original_example_meaning:W,modified_example_meaning:we,original_word_class:F,modified_word_class:be,device_unique_id:H}=o??{},{selectNextUserMeaning:Se}=K(),{removeUserMeaningFromList:Ee}=G({token:n,appName:a}),[I,Ie,J]=L(S),[f,Le,X]=L(q),[v,ke,Y]=L(Me),[C,Pe,Z]=L(Ue),[y,_e,ee]=L(we),[M,Ae,ne]=L(be),$=()=>{J(),X(),Y(),Z(),ee(),ne()},se=()=>{$(),i.invalidateQueries(),Se({id:r}),Ee({seq:d}),t({severity:"success",message:"삭제하였습니다."})},P=()=>t({severity:"error",message:"삭제에 실패하였습니다. 다시 시도해주세요."}),{mutate:Ne}=dn({onSuccess:se,onError:P}),ie=()=>{if(a===void 0||d===void 0){P();return}Ne({token:n,appName:a,seq:Number(d),word:(I??"").trim()!==""?I:void 0,pronunciation:(f??"").trim()!==""?f:void 0,meaning:(v??"").trim()!==""?v:void 0,example:(C??"").trim()!==""?C:void 0,exampleMeaning:(y??"").trim()!==""?y:void 0,wordClass:(M??"").trim()!==""?M:void 0})},{mutate:We}=Oe({onSuccess:ie,onError:P}),{deleteSelectedUserMeaning:Fe}=fn({onSuccess:se,onError:P}),{skipSelectedUserMeaning:$e}=vn({onSuccess:()=>{i.invalidateQueries(),t({severity:"success",message:"스킵하였습니다."})},onError:()=>{t({severity:"error",message:"스킵에 실패하였습니다. 다시 시도해주세요."})}}),{addWrongPronunciation:De}=Ke({onSuccess:ie,onError:P});if(o===void 0)return;const Qe=D=>{navigator.clipboard.writeText(D).then(()=>{i.invalidateQueries(),t({severity:"success",message:"복사하였습니다."})},()=>{t({severity:"error",message:"복사에 실패하였습니다. 다시 시도해주세요."})})},ze=()=>Qe(`${d}`),Te=()=>{var re;const D=((re=s.current)==null?void 0:re.value)??"";r===void 0||D===""||d===void 0||a===void 0||We({token:n,seq:d,appName:a,userQuery:D,word:g,modifiedWord:S,originalMeaning:j,modifiedMeaning:v,originalPronunciation:E,modifiedPronunciation:f,originalExample:N,modifiedExample:C,originalExampleMeaning:W,modifiedExampleMeaning:y,originalWordClass:F,modifiedWordClass:M,deviceUniqueId:H,os:l})},qe=()=>{d===void 0||a===void 0||["",void 0].includes(g)||(De({seq:d,appName:a,word:g,modifiedWord:I,originalMeaning:j,modifiedMeaning:v,originalPronunciation:E,modifiedPronunciation:f,originalExample:N,modifiedExample:C,originalExampleMeaning:W,modifiedExampleMeaning:y,originalWordClass:F,modifiedWordClass:M,deviceUniqueId:H,os:l}),$())},Re=()=>{Fe(),$()},Be=()=>{$e(),$()};return e.jsxs(w,{sx:{overflow:"auto",p:3,height:"100vh"},children:[e.jsx(_,{component:"h2",variant:"h5",children:"기본 정보"}),e.jsx(ae,{sx:{mb:3},children:e.jsxs(oe,{sx:{minWidth:650},"aria-label":"단어 기본 정보",size:"small",children:[e.jsx(ce,{children:e.jsxs(h,{children:[e.jsx(c,{children:"OS"}),e.jsx(c,{children:"Seq"}),e.jsx(c,{children:"Part"}),e.jsx(c,{children:"Unit"}),e.jsx(c,{children:"Index"})]})}),e.jsx(de,{children:e.jsxs(h,{children:[e.jsx(c,{children:l}),e.jsxs(c,{children:[d,e.jsx(he,{"aria-label":"copy",size:"small",onClick:ze,children:e.jsx(Ze,{fontSize:"small"})})]}),e.jsx(c,{children:x}),e.jsx(c,{children:u}),e.jsx(c,{children:m})]})})]})}),e.jsx(_,{component:"h2",variant:"h5",children:"수정 정보"}),e.jsx(ae,{sx:{mb:3},children:e.jsxs(oe,{sx:{minWidth:650},"aria-label":"단어 수정 정보",size:"small",children:[e.jsx(ce,{children:e.jsxs(h,{children:[e.jsx(c,{width:"10%",children:"구분"}),e.jsx(c,{width:"30%",children:"원본"}),e.jsx(c,{width:"60%",children:"수정"})]})}),e.jsxs(de,{children:[e.jsxs(h,{children:[e.jsx(c,{component:"th",scope:"row",children:"단어"}),e.jsx(c,{sx:{fontSize:16},children:g}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"word input",value:I,onClear:J,onChange:Ie},`${r}-word`)})]}),e.jsxs(h,{children:[e.jsx(c,{component:"th",scope:"row",children:"발음"}),e.jsx(c,{sx:{fontSize:16},children:E}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"pronunciation input",value:f,onClear:X,onChange:Le},`${r}-pronunciation`)})]}),e.jsxs(h,{children:[e.jsx(c,{component:"th",scope:"row",children:"뜻"}),e.jsx(c,{sx:{fontSize:16},children:j}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"meaning input",value:v,onClear:Y,onChange:ke},`${r}-meaning`)})]}),e.jsxs(h,{children:[e.jsx(c,{component:"th",scope:"row",children:"예제"}),e.jsx(c,{sx:{fontSize:16},children:N}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"example input",value:C,onClear:Z,onChange:Pe},`${r}-example`)})]}),e.jsxs(h,{children:[e.jsx(c,{component:"th",scope:"row",children:"예제 뜻"}),e.jsx(c,{sx:{fontSize:16},children:W}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"example meaning input",value:y,onClear:ee,onChange:_e},`${r}-example-meaning`)})]}),e.jsxs(h,{children:[e.jsx(c,{component:"th",scope:"row",children:"품사"}),e.jsx(c,{sx:{fontSize:16},children:F}),e.jsx(c,{children:e.jsx(U,{ariaLabel:"word class input",value:M,onClear:ne,onChange:Ae},`${r}-word-class`)})]})]})]})}),e.jsx(_,{component:"h2",variant:"h5",children:"SQL query"}),e.jsx(U,{inputRef:s,ariaLabel:"SQL query input",rows:5,defaultValue:He({seq:d,word:g,editedWord:I,editedPronunciation:f,originalPronunciation:E,editedMeaning:v,originalMeaning:j,editedExample:C,originalExample:N,editedExampleMeaning:y,originalExampleMeaning:W,editedWordClass:M,originalWordClass:F})},`${I}-${f}-${v}-${C}-${y}-${M}`),e.jsx(w,{justifyContent:"center",sx:{width:1,display:"flex",mt:2},children:e.jsxs(en,{spacing:6,direction:"row",children:[e.jsx(Q,{variant:"contained",sx:{px:8},startIcon:e.jsx(nn,{}),onClick:Te,children:"수정"}),e.jsx(Q,{variant:"contained",sx:{px:8},startIcon:e.jsx(sn,{}),onClick:qe,children:"발음 이상"}),e.jsx(Q,{variant:"contained",color:"error",sx:{px:8},startIcon:e.jsx(rn,{}),onClick:Re,children:"삭제"}),e.jsx(Q,{variant:"contained",color:"success",sx:{px:8},startIcon:e.jsx(tn,{}),onClick:Be,children:"스킵"})]})})]})},ue=200,yn=()=>{const{appName:i}=A(),{showAlertSnackbar:s}=p.useContext(z),[n,t]=cn(k),o=p.useRef(null),{userMeanings:a,hasNextPage:r,isFetchingNextPage:d,fetchNextPage:l}=O({onError:()=>{s({severity:"error",message:"단어 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),x=u=>t(u);if(p.useEffect(()=>{if(!o.current)return;const u=new IntersectionObserver(m=>{m[0].isIntersecting&&r&&l()});return u.observe(o.current),()=>u.disconnect()},[o,r,l]),!(i===void 0||a===void 0||a.length===0))return e.jsx(me,{variant:"permanent",sx:{width:ue,flexShrink:0,"& .MuiDrawer-paper":{width:ue,boxSizing:"border-box",position:"absolute"}},children:e.jsx(w,{sx:{overflow:"auto"},children:e.jsxs(ge,{children:[a.map(u=>e.jsx(je,{disablePadding:!0,children:e.jsx(fe,{selected:u===n,onClick:()=>x(u),children:e.jsx(ve,{primary:e.jsxs(e.Fragment,{children:[u.by_part,"/",u.by_unit,"/",u.by_index,e.jsx("br",{}),u.word]})})})},u.id)),e.jsx("div",{ref:o,style:{height:40},children:d&&e.jsx(an,{})})]})})})},Pn=()=>{const{showAlertSnackbar:i}=p.useContext(z),{isLoadingApps:s}=pe({onError:()=>{i({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),{isLoadingUserMeanings:n}=O({onError:()=>{i({severity:"error",message:"단어 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}});return e.jsx(on,{component:"main",maxWidth:!1,sx:{position:"relative"},disableGutters:!0,children:e.jsx(w,{display:"flex",height:"100vh",children:s?e.jsx(te,{}):e.jsxs(e.Fragment,{children:[e.jsx(jn,{}),n?e.jsx(te,{}):e.jsxs(w,{sx:{display:"flex",flexGrow:1,position:"relative"},children:[e.jsx(yn,{}),e.jsx(w,{sx:{flexGrow:1,position:"relative"},children:e.jsx(Cn,{})})]})]})})})};export{Pn as default};
