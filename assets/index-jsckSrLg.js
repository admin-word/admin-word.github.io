import{r as d,j as e,u as ae,o as de}from"./vendor-B1gV91ol.js";import{A as G,U as X,P as Y}from"./index-h4SDZcon.js";import{u as Z,S as le,b as ce,a as ue,c as xe}from"./index-CjrOE57i.js";import{D as he,B as w,L as pe,b as fe,c as me,f as ge,m as K,n as y,N as H,I as ve,p as je,O as ye,t as U,u as f,x as We,o as z,q as Se,P as be,r as Ce,s as Pe,Q as $,v as V,i as Ee,C as we}from"./vendor-ui-OeklMkKU.js";import{c as L,u as Me}from"./vendor-route-DDSpTbF5.js";import{u as ke,b as ee}from"./vendor-store-zNU_bmKY.js";import{W as Ie,u as Ae}from"./index-zsJ_DbT9.js";import{a as Te}from"./index-t--hEgTQ.js";const Ne=async({token:o,appName:t,word:i,pageIndex:a,sort:l})=>await Te.get(Ie,{headers:{"word-app-api-key":o},params:{page:a,appName:t,word:i,sort:l}}),J=200,Ue=()=>{const{appName:o}=L(),{showAlertSnackbar:t}=d.useContext(G),{data:i}=Z({onError:()=>{t({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),a=ke(le),l=Me();d.useEffect(()=>{var r;((r=i==null?void 0:i.find(({name:c})=>c===o))==null?void 0:r.count)===0&&(l("/words",{replace:!0}),a(void 0))});const x=s=>{a(void 0),l(`/words/${s}`)};return e.jsx(he,{variant:"permanent",sx:{width:J,flexShrink:0,"& .MuiDrawer-paper":{width:J,boxSizing:"border-box",position:"absolute"}},children:e.jsx(w,{sx:{overflow:"auto"},children:e.jsx(pe,{children:i==null?void 0:i.map(({name:s,word_counts:r,reviewed_word_counts:c})=>e.jsx(fe,{disablePadding:!0,children:e.jsx(me,{disabled:r===0,selected:s===o,onClick:()=>x(s),children:e.jsx(ge,{primary:s,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(K,{component:"span",display:"block",children:["- 단어 수: ",r]}),e.jsxs(K,{component:"span",display:"block",children:["- 리뷰 수: ",c]}),e.jsxs(K,{component:"span",display:"block",children:["- 남은 수: ",r-c]})]})})})},s))})})})},Le=({onSearch:o})=>{const t=d.useRef(null),[i,a]=d.useState(void 0),[l,x]=d.useState(void 0),s=u=>u!==void 0,r=()=>{if(i===void 0){o(void 0);return}if(!s(i)){x("유효하지 않은 검색어입니다. 올바른 검색어를 입력해 주세요.");return}o(i)},c=u=>{var h;u.key==="Enter"&&((h=t.current)==null||h.blur())},m=()=>{a(void 0),o(void 0)};return e.jsx(w,{p:2,zIndex:2,children:e.jsx(y,{sx:{width:"30%"},inputRef:t,inputMode:"numeric",variant:"outlined",placeholder:"단어 검색",error:l!==void 0,helperText:l,onFocus:()=>x(void 0),value:i??"",onKeyDown:c,onChange:u=>a(u.target.value),onBlur:r,slotProps:{input:{startAdornment:e.jsx(H,{position:"start",children:e.jsx(ye,{})}),endAdornment:i!==void 0&&e.jsx(H,{position:"end",children:e.jsx(ve,{onClick:m,size:"small",children:e.jsx(je,{})})})}}})})},_e=({id:o,seq:t,part:i,unit:a,index:l,isReviewed:x,word:s,pronunciation:r,meaning:c,example:m,exampleMeaning:u,wordClass:h})=>{const M=ae(),{appName:g}=L(),{showAlertSnackbar:W}=d.useContext(G),{token:p}=ee(X),[v,k]=d.useState(s),[S,I]=d.useState(r),[b,A]=d.useState(c),[C,T]=d.useState(m),[P,N]=d.useState(u),[E,O]=d.useState(h),_=s!==v?v:void 0,R=r!==S?S:void 0,Q=c!==b?b:void 0,B=m!==C?C:void 0,D=u!==P?P:void 0,F=h!==E?E:void 0,ne=()=>{M.invalidateQueries(),W({severity:"success",message:"수정하였습니다."})},j=n=>{W({severity:"error",message:`실패하였습니다. 다시 시도해주세요.
${n}`})},{addWrongPronunciation:ie}=ce({onSuccess:()=>{if(g===void 0){j("(appName is undefined)");return}q({token:p,appName:g,seq:t,word:_,pronunciation:R,meaning:Q,example:B,exampleMeaning:D,wordClass:F,isReviewed:!1})},onError:()=>{W({severity:"error",message:"삭제에 실패하였습니다. 다시 시도해주세요."})}}),{mutate:q}=Ae({onSuccess:ne,onError:()=>j("(updateWord is failed)")}),{mutate:te}=ue({onSuccess:()=>{if(g===void 0){j("(appName is undefined)");return}q({token:p,appName:g,seq:t,word:_,pronunciation:R,meaning:Q,example:B,exampleMeaning:D,wordClass:F,isReviewed:!0})},onError:()=>j("(createUserQuery is failed)")}),re=()=>{if(g===void 0){j("(appName is undefined)");return}q({token:p,appName:g,seq:t,isReviewed:!x})},se=()=>{if(g===void 0){j("(appName is undefined)");return}ie({seq:t.toString(),appName:g,word:s,originalMeaning:c,originalPronunciation:r,originalExample:m,originalExampleMeaning:u,originalWordClass:h,modifiedWord:void 0,modifiedMeaning:void 0,modifiedPronunciation:void 0,modifiedExample:void 0,modifiedExampleMeaning:void 0,modifiedWordClass:void 0,deviceUniqueId:"PC",os:"PC"})},oe=()=>{const n=xe({seq:t.toString(),word:s,editedWord:v,originalPronunciation:r,editedPronunciation:S,originalMeaning:c,editedMeaning:b,originalExample:m,editedExample:C,originalExampleMeaning:u,editedExampleMeaning:P,originalWordClass:h,editedWordClass:E});g!==void 0&&n!==void 0?te({token:p,seq:t.toString(),appName:g,userQuery:n,word:s,modifiedWord:_,originalPronunciation:r,modifiedPronunciation:R,originalMeaning:c,modifiedMeaning:Q,originalExample:m,modifiedExample:B,originalExampleMeaning:u,modifiedExampleMeaning:D,originalWordClass:h,modifiedWordClass:F,deviceUniqueId:"PC",os:"PC"}):j("(Parameter is wrong)")};return d.useEffect(()=>{k(n=>n!==s?s:n),I(n=>n!==r?r:n),A(n=>n!==c?c:n),T(n=>n!==m?m:n),N(n=>n!==u?u:n),O(n=>n!==h?h:n)},[s,r,c,m,u,h]),e.jsxs(U,{children:[e.jsx(f,{children:t}),e.jsxs(f,{children:[i,"/",a,"/",l]}),e.jsx(f,{children:x===1?"✅":"-"}),e.jsxs(f,{children:[e.jsx(y,{fullWidth:!0,variant:"outlined",onChange:n=>k(n.target.value),value:v}),r!==void 0&&e.jsx(y,{fullWidth:!0,variant:"outlined",onChange:n=>I(n.target.value),value:S}),e.jsx(y,{fullWidth:!0,variant:"outlined",onChange:n=>A(n.target.value),value:b}),e.jsx(y,{fullWidth:!0,variant:"outlined",onChange:n=>O(n.target.value),value:E})]}),e.jsxs(f,{children:[e.jsx(y,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",onChange:n=>T(n.target.value),value:C}),e.jsx(y,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",onChange:n=>N(n.target.value),value:P})]}),e.jsx(f,{children:e.jsxs(We,{direction:"column",spacing:1.5,children:[e.jsx(z,{variant:"contained",color:x?"inherit":"success",onClick:re,children:x?"리뷰 취소":"리뷰"}),e.jsx(z,{variant:"contained",color:"info",onClick:se,children:"발음 이상"}),e.jsx(z,{variant:"contained",color:"error",onClick:oe,children:"수정"})]})})]},o)},Re=(o,t)=>["Words",o,t],Qe=({token:o,appName:t,word:i,sort:a})=>de({queryKey:Re(o,t),enabled:t!==void 0,staleTime:1/0,gcTime:1/0,initialPageParam:1,queryFn:async({pageParam:l})=>(await Ne({token:o,appName:t,word:i,sort:a,pageIndex:l})).data,getNextPageParam:l=>l.next_page??void 0,select:l=>l.pages.map(x=>x.words).flat()}),Be=()=>{const{appName:o}=L(),{token:t}=ee(X),i=d.useRef(null),[a,l]=d.useState("part"),[x,s]=d.useState(void 0),{data:r,isLoading:c,isFetchingNextPage:m,hasNextPage:u,refetch:h,fetchNextPage:M}=Qe({token:t,appName:o,sort:a,word:x}),g=p=>{s(p),setTimeout(()=>{h()})},W=p=>{l(p),setTimeout(()=>{h()})};return d.useEffect(()=>{if(!i.current)return;const p=new IntersectionObserver(v=>{v[0].isIntersecting&&u&&M()});return p.observe(i.current),()=>p.disconnect()},[i,u,M]),e.jsxs(w,{width:"100%",height:"100%",display:"flex",flexDirection:"column",children:[e.jsx(Le,{onSearch:g}),e.jsx(Se,{component:be,children:e.jsxs(Ce,{stickyHeader:!0,children:[e.jsx(Pe,{children:e.jsxs(U,{children:[e.jsx(f,{children:"Seq"}),e.jsx(f,{children:e.jsx($,{active:["part","-part"].includes(a),direction:a.includes("-")?"asc":"desc",onClick:()=>W(a.includes("-")?"part":"-part"),children:"Part/Unit/Index"})}),e.jsx(f,{children:e.jsx($,{active:["review","-review"].includes(a),direction:a.includes("-")?"asc":"desc",onClick:()=>W(a.includes("-")?"review":"-review"),children:"Review"})}),e.jsx(f,{style:{width:"25%"},children:"Word"}),e.jsx(f,{style:{width:"50%"},children:"Example"}),e.jsx(f,{children:"Action"})]})}),c?e.jsx(V,{children:e.jsx(U,{children:e.jsx(f,{colSpan:6,align:"center",style:{padding:0,border:"none"},children:e.jsx(Y,{})})})}):e.jsxs(V,{children:[r==null?void 0:r.map(({id:p,seq:v,by_part:k,by_unit:S,by_index:I,is_reviewed:b,word:A,pronunciation:C,meaning:T,example:P,example_meaning:N,word_class:E})=>e.jsx(_e,{id:p,seq:v,part:k??"",unit:S??"",index:I??"",isReviewed:b,word:A,pronunciation:C,meaning:T,example:P??"",exampleMeaning:N??"",wordClass:E??""},p)),e.jsx(U,{children:e.jsx(f,{colSpan:6,align:"center",style:{padding:0,border:"none"},children:e.jsx("div",{ref:i,style:{height:40},children:m&&e.jsx(Ee,{})})})})]})]})})]})},$e=()=>{const{appName:o}=L(),{showAlertSnackbar:t}=d.useContext(G),{isLoadingApps:i}=Z({onError:()=>{t({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}});return e.jsx(we,{component:"main",maxWidth:!1,sx:{position:"relative"},disableGutters:!0,children:e.jsx(w,{display:"flex",height:"100vh",children:i?e.jsx(Y,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{}),e.jsx(w,{sx:{display:"flex",flexGrow:1,position:"relative"},children:o!==void 0&&e.jsx(Be,{})})]})})})};export{$e as default};
