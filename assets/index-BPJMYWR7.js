import{m as S,j as e,u as Q,r as C,o as V}from"./vendor-B1gV91ol.js";import{U as A,A as B,P as G}from"./index-BX_kuCcN.js";import{u as H}from"./index-C5HxE152.js";import{a as T}from"./index-t--hEgTQ.js";import{U as K}from"./common-MNloumS_.js";import{z,E as J,F as X,G as Y,r as I,s as D,t as d,u as i,v as q,m as N,J as $,K as Z,o as U,M as ee,q as ie,P as ne}from"./vendor-ui-OeklMkKU.js";import{b as k}from"./vendor-store-zNU_bmKY.js";import"./vendor-route-DDSpTbF5.js";var re={VITE_API_SERVER:"https://posstree.com/api/word_app"};const W=`${re.VITE_API_SERVER}/admin/update_queries`,se=async({token:r,id:o})=>{await T.delete(`${W}/${o}`,{headers:{"word-app-api-key":r},data:{id:o}})},oe=async({token:r,pageIndex:o})=>{const s=await T.get(`${W}?page=${o}`,{headers:{"word-app-api-key":r}});return{currentPage:s.data.current_page,from:s.data.from,lastPage:s.data.last_page,to:s.data.to,total:s.data.total,data:s.data.data.map(n=>({id:n.id,appName:n.app_name,query:n.query,word:n.word,seq:n.seq??void 0,part:n.by_part??void 0,unit:n.by_unit??void 0,index:n.by_index??void 0,modifiedWord:n.modified_word,originalMeaning:n.original_meaning??void 0,modifiedMeaning:n.modified_meaning??void 0,originalExample:n.original_example??void 0,modifiedExample:n.modified_example??void 0,originalExampleMeaning:n.original_example_meaning??void 0,modifiedExampleMeaning:n.modified_example_meaning??void 0,originalPronunciation:n.original_pronunciation??void 0,modifiedPronunciation:n.modified_pronunciation??void 0,deviceUniqueId:n.device_unique_id??void 0,os:n.os??void 0,version:n.version,createdAt:n.created_at}))}},de=async({token:r,appName:o,seq:s,word:n,modifiedWord:t,originalPronunciation:j,modifiedPronunciation:E,originalMeaning:l,modifiedMeaning:p,originalExample:c,modifiedExample:x,originalExampleMeaning:g,modifiedExampleMeaning:w,deviceUniqueId:y,os:m,isRestore:a})=>{await T.post(K,{app_name:o,seq:s,word:n,modified_word:t,original_pronunciation:j,modified_pronunciation:E,original_meaning:l,modified_meaning:p,original_example:c,modified_example:x,original_example_meaning:g,modified_example_meaning:w,device_unique_id:y,os:m,is_restore:a},{headers:{"word-app-api-key":r}})},ae=({onSuccess:r,onError:o})=>S({mutationFn:de,onSuccess:r,onError:o}),le=({onSuccess:r,onError:o})=>S({mutationFn:se,onSuccess:r,onError:o}),te=({updateQuery:r,isOpenDialog:o,onExecute:s,onClose:n})=>{const{id:t,appName:j,version:E,seq:l,part:p,unit:c,index:x,word:g,modifiedWord:w,originalPronunciation:y,modifiedPronunciation:m,originalMeaning:a,modifiedMeaning:h,originalExample:u,modifiedExample:f,originalExampleMeaning:v,modifiedExampleMeaning:_,createdAt:P,query:M}=r;return e.jsxs(z,{open:o,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(J,{id:"alert-dialog-title",children:"수정 내용 복원"}),e.jsxs(X,{children:[e.jsx(Y,{id:"alert-dialog-description",children:"수정하신 내용을 복원하시겠습니까?"}),e.jsxs(I,{sx:{maxWidth:650},children:[e.jsx(D,{children:e.jsxs(d,{children:[e.jsx(i,{children:"앱 이름"}),e.jsx(i,{children:"Seq"}),e.jsx(i,{children:"버전"}),e.jsx(i,{children:"Level"}),e.jsx(i,{children:"Unit"}),e.jsx(i,{children:"Index"})]})}),e.jsx(q,{children:e.jsxs(d,{children:[e.jsx(i,{children:j}),e.jsx(i,{children:l}),e.jsx(i,{children:E}),e.jsx(i,{children:p}),e.jsx(i,{children:c}),e.jsx(i,{children:x!==void 0?x+1:void 0})]})})]}),e.jsx("br",{}),e.jsx(N,{component:"h2",variant:"h5",children:"상세 정보"}),e.jsx(I,{sx:{maxWidth:650},children:e.jsxs(q,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"단어"}),e.jsx(i,{children:g})]}),e.jsxs(d,{children:[e.jsx(i,{children:"수정된 단어"}),e.jsx(i,{children:w})]}),e.jsxs(d,{children:[e.jsx(i,{children:"발음"}),e.jsx(i,{children:y})]}),e.jsxs(d,{children:[e.jsx(i,{children:"수정된 발음"}),e.jsx(i,{children:M.includes("INSERT INTO wrong_pronunciation_words (word)")?e.jsx($,{label:"발음 이상"}):m})]}),e.jsxs(d,{children:[e.jsx(i,{children:"의미"}),e.jsx(i,{children:a})]}),e.jsxs(d,{children:[e.jsx(i,{children:"수정된 의미"}),e.jsx(i,{children:h})]}),e.jsxs(d,{children:[e.jsx(i,{children:"예문"}),e.jsx(i,{children:u})]}),e.jsxs(d,{children:[e.jsx(i,{children:"수정된 예문"}),e.jsx(i,{children:f})]}),e.jsxs(d,{children:[e.jsx(i,{children:"예문 의미"}),e.jsx(i,{children:v})]}),e.jsxs(d,{children:[e.jsx(i,{children:"수정된 예문 의미"}),e.jsx(i,{children:_})]}),e.jsxs(d,{children:[e.jsx(i,{children:"수정 일자"}),e.jsx(i,{children:P.split(".")[0]})]})]})})]}),e.jsxs(Z,{children:[e.jsx(U,{onClick:()=>s(t),color:"error",variant:"contained",children:"복원"}),e.jsx(U,{onClick:n,autoFocus:!0,variant:"outlined",children:"취소"})]})]})},ce=({updateQuery:r})=>{const{token:o}=k(A),s=Q(),[n,t]=C.useState(!1),{showAlertSnackbar:j}=C.useContext(B),E=()=>{s.invalidateQueries(),j({severity:"success",message:"복원에 성공하였습니다."})},l=()=>{j({severity:"error",message:"복원에 실패하였습니다. 다시 시도해주세요."})},{mutate:p}=H({onSuccess:E,onError:l}),{mutate:c}=le({onSuccess:()=>{const{appName:m,seq:a,word:h,originalPronunciation:u,originalMeaning:f,originalExample:v,originalExampleMeaning:_}=r;if(a===void 0){l();return}p({token:o,appName:m,seq:a,word:(h??"").trim()!==""?h:void 0,pronunciation:(u??"").trim()!==""?u:void 0,meaning:(f??"").trim()!==""?f:void 0,example:(v??"").trim()!==""?v:void 0,exampleMeaning:(_??"").trim()!==""?_:void 0,isReviewed:!1})},onError:l}),{mutate:x}=ae({onSuccess:()=>{c({token:o,id:r.id})},onError:l}),g=()=>{t(!0)},w=()=>{const{appName:m,seq:a,word:h,modifiedWord:u,originalPronunciation:f,modifiedPronunciation:v,originalMeaning:_,modifiedMeaning:P,originalExample:M,modifiedExample:b,originalExampleMeaning:F,modifiedExampleMeaning:L,deviceUniqueId:O,os:R}=r;a===void 0||h===void 0||(R!=="PC"?x({token:o,appName:m,seq:a,word:h,modifiedWord:u,originalPronunciation:f,modifiedPronunciation:v,originalMeaning:_,modifiedMeaning:P,originalExample:M,modifiedExample:b,originalExampleMeaning:F,modifiedExampleMeaning:L,deviceUniqueId:O,os:R,isRestore:!0}):c({token:o,id:r.id}),t(!1))},y=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[new Date(r.createdAt)<=new Date?e.jsx(ee,{title:e.jsxs(e.Fragment,{children:["이미 반영된 단어여서 복원할 수 없습니다.",e.jsx("br",{}),"단어의 정보를 확인하여 앱에서 단어 수정 신고를 한 후, 올바르게 수정해 주시기 바랍니다."]}),children:e.jsx("span",{children:e.jsx(U,{variant:"contained",color:"error",disabled:!0,children:"복원"})})}):e.jsx(U,{variant:"contained",color:"error",onClick:g,children:"복원"}),e.jsx(te,{updateQuery:r,isOpenDialog:n,onClose:y,onExecute:w})]})},xe=(r,o)=>[`UpdateQueries_${r}_${o}`],me=({token:r,pageIndex:o=1})=>V({queryKey:xe(r,o),staleTime:1/0,gcTime:1/0,initialPageParam:1,queryFn:async({pageParam:s})=>oe({token:r,pageIndex:s}),getNextPageParam:s=>{if(s.currentPage!==s.lastPage)return s.currentPage+1},select:s=>s.pages.map(n=>n.data).flat()}),Ee=()=>{const{token:r}=k(A),{isLoading:o,data:s}=me({token:r,pageIndex:1});return o?e.jsx(G,{}):e.jsxs(ie,{component:ne,children:[e.jsx(N,{component:"h2",variant:"h5",sx:{ml:4,mt:4},children:"수정 리스트"}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(d,{children:[e.jsx(i,{children:"앱 이름"}),e.jsx(i,{children:"버전"}),e.jsx(i,{children:"OS"}),e.jsx(i,{children:"단어 정보"}),e.jsx(i,{children:"단어"}),e.jsx(i,{children:"수정된 단어"}),e.jsx(i,{children:"발음"}),e.jsx(i,{children:"수정된 발음"}),e.jsx(i,{children:"의미"}),e.jsx(i,{children:"수정된 의미"}),e.jsx(i,{children:"예문"}),e.jsx(i,{children:"수정된 예문"}),e.jsx(i,{children:"예문 의미"}),e.jsx(i,{children:"수정된 예문 의미"}),e.jsx(i,{children:"수정 일자"}),e.jsx(i,{children:"복원"})]})}),e.jsx(q,{children:s==null?void 0:s.map(n=>{const{id:t,appName:j,os:E,version:l,seq:p,part:c,unit:x,index:g,word:w,modifiedWord:y,originalPronunciation:m,modifiedPronunciation:a,originalMeaning:h,modifiedMeaning:u,originalExample:f,modifiedExample:v,originalExampleMeaning:_,modifiedExampleMeaning:P,createdAt:M,query:b}=n;return e.jsxs(d,{children:[e.jsx(i,{children:j}),e.jsx(i,{children:l}),e.jsx(i,{children:E}),e.jsxs(i,{children:[p!==void 0?`[${p}]`:void 0,e.jsx("br",{}),c!==void 0?`${c}`:void 0,x!==void 0?`/${x}`:void 0,g!==void 0?`/${g+1}`:void 0]}),e.jsx(i,{children:w}),e.jsx(i,{children:y}),e.jsx(i,{children:m}),e.jsx(i,{children:b.includes("INSERT INTO wrong_pronunciation_words (word)")?e.jsx($,{label:"발음 이상"}):a}),e.jsx(i,{children:h}),e.jsx(i,{children:u}),e.jsx(i,{children:f}),e.jsx(i,{children:v}),e.jsx(i,{children:_}),e.jsx(i,{children:P}),e.jsx(i,{children:M.split(".")[0]}),e.jsx(i,{children:e.jsx(ce,{updateQuery:n})})]},t)})})]})]})};export{Ee as default};
