import{r as u,j as e,u as re,o as te}from"./vendor-B1gV91ol.js";import{A as q,U as H,P as $}from"./index-BX_kuCcN.js";import{u as V,S as se,b as oe,a as ae,c as de}from"./index-CD0OFpat.js";import{D as ce,B as M,L as le,b as ue,c as xe,f as he,m as D,n as W,N as K,I as pe,p as fe,O as me,t as N,u as p,x as ge,o as F,q as ve,P as je,r as ye,s as Se,Q as z,v as G,i as be,C as Pe}from"./vendor-ui-OeklMkKU.js";import{c as U,u as we}from"./vendor-route-DDSpTbF5.js";import{u as We,b as J}from"./vendor-store-zNU_bmKY.js";import{W as Ee,u as Ce}from"./index-C5HxE152.js";import{a as Me}from"./index-t--hEgTQ.js";const ke=async({token:o,appName:r,word:i,pageIndex:a,sort:d})=>await Me.get(Ee,{headers:{"word-app-api-key":o},params:{page:a,appName:r,word:i,sort:d}}),O=200,Ie=()=>{const{appName:o}=U(),{showAlertSnackbar:r}=u.useContext(q),{data:i}=V({onError:()=>{r({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}}),a=We(se),d=we();u.useEffect(()=>{var t;((t=i==null?void 0:i.find(({name:c})=>c===o))==null?void 0:t.count)===0&&(d("/words",{replace:!0}),a(void 0))});const x=s=>{a(void 0),d(`/words/${s}`)};return e.jsx(ce,{variant:"permanent",sx:{width:O,flexShrink:0,"& .MuiDrawer-paper":{width:O,boxSizing:"border-box",position:"absolute"}},children:e.jsx(M,{sx:{overflow:"auto"},children:e.jsx(le,{children:i==null?void 0:i.map(({name:s,word_counts:t,reviewed_word_counts:c})=>e.jsx(ue,{disablePadding:!0,children:e.jsx(xe,{disabled:t===0,selected:s===o,onClick:()=>x(s),children:e.jsx(he,{primary:s,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(D,{component:"span",display:"block",children:["- 단어 수: ",t]}),e.jsxs(D,{component:"span",display:"block",children:["- 리뷰 수: ",c]}),e.jsxs(D,{component:"span",display:"block",children:["- 남은 수: ",t-c]})]})})})},s))})})})},Ae=({onSearch:o})=>{const r=u.useRef(null),[i,a]=u.useState(void 0),[d,x]=u.useState(void 0),s=l=>l!==void 0,t=()=>{if(i===void 0){o(void 0);return}if(!s(i)){x("유효하지 않은 검색어입니다. 올바른 검색어를 입력해 주세요.");return}o(i)},c=l=>{var g;l.key==="Enter"&&((g=r.current)==null||g.blur())},m=()=>{a(void 0),o(void 0)};return e.jsx(M,{p:2,zIndex:2,children:e.jsx(W,{sx:{width:"30%"},inputRef:r,inputMode:"numeric",variant:"outlined",placeholder:"단어 검색",error:d!==void 0,helperText:d,onFocus:()=>x(void 0),value:i??"",onKeyDown:c,onChange:l=>a(l.target.value),onBlur:t,slotProps:{input:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(me,{})}),endAdornment:i!==void 0&&e.jsx(K,{position:"end",children:e.jsx(pe,{onClick:m,size:"small",children:e.jsx(fe,{})})})}}})})},Te=({id:o,seq:r,part:i,unit:a,index:d,isReviewed:x,word:s,pronunciation:t,meaning:c,example:m,exampleMeaning:l})=>{const g=re(),{appName:f}=U(),{showAlertSnackbar:E}=u.useContext(q),{token:v}=J(H),[h,y]=u.useState(s),[S,k]=u.useState(t),[b,I]=u.useState(c),[P,A]=u.useState(m),[w,T]=u.useState(l),C=s!==h?h:void 0,L=t!==S?S:void 0,R=c!==b?b:void 0,_=m!==P?P:void 0,Q=l!==w?w:void 0,X=()=>{g.invalidateQueries(),E({severity:"success",message:"수정하였습니다."})},j=n=>{E({severity:"error",message:`실패하였습니다. 다시 시도해주세요.
${n}`})},{addWrongPronunciation:Y}=oe({onSuccess:()=>{if(f===void 0){j("(appName is undefined)");return}B({token:v,appName:f,seq:r,word:C,pronunciation:L,meaning:R,example:_,exampleMeaning:Q,isReviewed:!1})},onError:()=>{E({severity:"error",message:"삭제에 실패하였습니다. 다시 시도해주세요."})}}),{mutate:B}=Ce({onSuccess:X,onError:()=>j("(updateWord is failed)")}),{mutate:Z}=ae({onSuccess:()=>{if(f===void 0){j("(appName is undefined)");return}B({token:v,appName:f,seq:r,word:C,pronunciation:L,meaning:R,example:_,exampleMeaning:Q,isReviewed:!0})},onError:()=>j("(createUserQuery is failed)")}),ee=()=>{if(f===void 0){j("(appName is undefined)");return}B({token:v,appName:f,seq:r,isReviewed:!x})},ne=()=>{if(f===void 0){j("(appName is undefined)");return}Y({seq:r.toString(),appName:f,word:s,originalMeaning:c,originalPronunciation:t,originalExample:m,originalExampleMeaning:l,modifiedWord:void 0,modifiedMeaning:void 0,modifiedPronunciation:void 0,modifiedExample:void 0,modifiedExampleMeaning:void 0,deviceUniqueId:"PC",os:"PC"})},ie=()=>{const n=de({seq:r.toString(),word:s,editedWord:h,originalPronunciation:t,editedPronunciation:S,originalMeaning:c,editedMeaning:b,originalExample:m,editedExample:P,originalExampleMeaning:l,editedExampleMeaning:w});f!==void 0&&n!==void 0?Z({token:v,seq:r.toString(),appName:f,userQuery:n,word:s,modifiedWord:C,originalPronunciation:t,modifiedPronunciation:L,originalMeaning:c,modifiedMeaning:R,originalExample:m,modifiedExample:_,originalExampleMeaning:l,modifiedExampleMeaning:Q,deviceUniqueId:"PC",os:"PC"}):j("(Parameter is wrong)")};return u.useEffect(()=>{y(n=>n!==s?s:n),k(n=>n!==t?t:n),I(n=>n!==c?c:n),A(n=>n!==m?m:n),T(n=>n!==l?l:n)},[s,t,c,m,l]),e.jsxs(N,{children:[e.jsx(p,{children:r}),e.jsxs(p,{children:[i,"/",a,"/",d]}),e.jsx(p,{children:x===1?"✅":"-"}),e.jsxs(p,{children:[e.jsx(W,{fullWidth:!0,variant:"outlined",onChange:n=>y(n.target.value),value:h}),t!==void 0&&e.jsx(W,{fullWidth:!0,variant:"outlined",onChange:n=>k(n.target.value),value:S}),e.jsx(W,{fullWidth:!0,variant:"outlined",onChange:n=>I(n.target.value),value:b})]}),e.jsxs(p,{children:[e.jsx(W,{fullWidth:!0,multiline:!0,rows:3,variant:"outlined",onChange:n=>A(n.target.value),value:P}),e.jsx(W,{fullWidth:!0,multiline:!0,rows:3,variant:"outlined",onChange:n=>T(n.target.value),value:w})]}),e.jsx(p,{children:e.jsxs(ge,{direction:"column",spacing:1.5,children:[e.jsx(F,{variant:"contained",color:x?"inherit":"success",onClick:ee,children:x?"리뷰 취소":"리뷰"}),e.jsx(F,{variant:"contained",color:"info",onClick:ne,children:"발음 이상"}),e.jsx(F,{variant:"contained",color:"error",onClick:ie,children:"수정"})]})})]},o)},Ne=(o,r)=>["Words",o,r],Ue=({token:o,appName:r,word:i,sort:a})=>te({queryKey:Ne(o,r),enabled:r!==void 0,staleTime:1/0,gcTime:1/0,initialPageParam:1,queryFn:async({pageParam:d})=>(await ke({token:o,appName:r,word:i,sort:a,pageIndex:d})).data,getNextPageParam:d=>d.next_page??void 0,select:d=>d.pages.map(x=>x.words).flat()}),Le=()=>{const{appName:o}=U(),{token:r}=J(H),i=u.useRef(null),[a,d]=u.useState("part"),[x,s]=u.useState(void 0),{data:t,isLoading:c,isFetchingNextPage:m,hasNextPage:l,refetch:g,fetchNextPage:f}=Ue({token:r,appName:o,sort:a,word:x}),E=h=>{s(h),setTimeout(()=>{g()})},v=h=>{d(h),setTimeout(()=>{g()})};return u.useEffect(()=>{if(!i.current)return;const h=new IntersectionObserver(y=>{y[0].isIntersecting&&l&&f()});return h.observe(i.current),()=>h.disconnect()},[i,l,f]),e.jsxs(M,{width:"100%",height:"100%",display:"flex",flexDirection:"column",children:[e.jsx(Ae,{onSearch:E}),e.jsx(ve,{component:je,children:e.jsxs(ye,{stickyHeader:!0,children:[e.jsx(Se,{children:e.jsxs(N,{children:[e.jsx(p,{children:"Seq"}),e.jsx(p,{children:e.jsx(z,{active:["part","-part"].includes(a),direction:a.includes("-")?"asc":"desc",onClick:()=>v(a.includes("-")?"part":"-part"),children:"Part/Unit/Index"})}),e.jsx(p,{children:e.jsx(z,{active:["review","-review"].includes(a),direction:a.includes("-")?"asc":"desc",onClick:()=>v(a.includes("-")?"review":"-review"),children:"Review"})}),e.jsx(p,{style:{width:"25%"},children:"Word"}),e.jsx(p,{style:{width:"50%"},children:"Example"}),e.jsx(p,{children:"Action"})]})}),c?e.jsx(G,{children:e.jsx(N,{children:e.jsx(p,{colSpan:6,align:"center",style:{padding:0,border:"none"},children:e.jsx($,{})})})}):e.jsxs(G,{children:[t==null?void 0:t.map(({id:h,seq:y,by_part:S,by_unit:k,by_index:b,is_reviewed:I,word:P,pronunciation:A,meaning:w,example:T,example_meaning:C})=>e.jsx(Te,{id:h,seq:y,part:S??"",unit:k??"",index:b??"",isReviewed:I,word:P,pronunciation:A,meaning:w,example:T??"",exampleMeaning:C??""},h)),e.jsx(N,{children:e.jsx(p,{colSpan:6,align:"center",style:{padding:0,border:"none"},children:e.jsx("div",{ref:i,style:{height:40},children:m&&e.jsx(be,{})})})})]})]})})]})},ze=()=>{const{appName:o}=U(),{showAlertSnackbar:r}=u.useContext(q),{isLoadingApps:i}=V({onError:()=>{r({severity:"error",message:"단어 앱 목록을 불러오는데 실패하였습니다. 다시 시도해주세요."})}});return e.jsx(Pe,{component:"main",maxWidth:!1,sx:{position:"relative"},disableGutters:!0,children:e.jsx(M,{display:"flex",height:"100vh",children:i?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),e.jsx(M,{sx:{display:"flex",flexGrow:1,position:"relative"},children:o!==void 0&&e.jsx(Le,{})})]})})})};export{ze as default};
